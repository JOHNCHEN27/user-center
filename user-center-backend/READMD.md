# 用户中心项目

相当于一个用户管理系统。



## 需求分析

1、**登录/注册**

2、用户管理（仅管理员可见） 对用户的查询或者修改 -- 后续可根据需求扩展

3、用户校验 （校验条件可设置为是否收费）  -- 后续可根据需求扩展

## 技术选型

前端：HTML + CSS + JS + React + 组件库 Ant Design + Umi + Ant Design Pro(现成的管理系统)

后端:  

 Java

Spring：依赖注入框架，帮助管理Java对象，集成一些其他的内容

Springmvc：web框架，提供接口访问、restful接口等能力

mybatis：java操作数据库的框架，持久层框架，对jdbc的封装

mtbatis-plus: mybatis的增强版本，实现类基本的CRUD

springboot：快速启动/快速集成项目，不用自己管理spring配置，不用自己整合各种框架

mysql

部署：服务器/容器（平台）

## 项目计划

1. 初始化项目
 	1. 前端初始化   node 16.20.0(最好用指定版本)
          	1. 初始化项目
               	2. 引入一些组件之类
                    	3. 框架介绍/瘦身
 	2. 后端初始化
          	1. 准备环境（MySQL等）
               	2. 引入框架（整合框架）
2. 数据库设计
3. **登录/注册**
	1. 前端
	2. 后端
4. 用户管理（管理员可见） -- 对用户的增删查改
	1. 前端
	2. 后端

## 数据库表设计

有哪些表？ 表中字段？ 字段的类型？ 数据库字段添加索引?

表和表之间的关联

用户表：

id（主键） bigint

username（昵称） varchar

userAccount  登录账号

avatarUrl （头像） varchar

gender（性别） tinyint

password（密码）

phone（电话）

email（邮箱）

userStatus 用户状态   0 正常

isValid（是否有效 -- 比如被封号） tinyint

createTime （创建时间） datetime

updateTime（更新时间） datetime

isDelete （是否删除 --逻辑删除） tinyint

## 自动生成器的使用

MybatisX插件，自动根据数据库表内容生成domain实体对象、mapper、mapper.xml、service。

**注意：如果数据库表字段名和实体属性名一致，则不需要开启mybatis-plus的自动驼峰命名规范** （自动生成的实体默认和数据库字段名一致）

generateAllSetDefault插件，可以在新创建的对象快速设置默认值，用于快速测试，提高开发效率



## 注册逻辑

1.用户在前端输入账户、密码以及校验码（可采用图形验证码等）

2.校验用户账号、密码、校验码是否符合要求

1. 账号不小于四位
2. 密码不小于八位
3. 其他校验
4. **账户不能重复**
5. **账户不包含特殊字符 ** --正则表达式判断
6. **密码和校验密码相同**  

**3.对密码进行加密（密码必须加密，不能以明文存储到数据库中）** -- 采用加密算法

4.向数据库插入用户数据

**5.单元测试 对每项逻辑进行测试**



## 登录功能

**登录接口**

接受参数： 账户、密码（可扩展校验码）

请求参数：POSR   *请求参数很长时不建议使用get*

请求体： JSON格式数据

返回值：用户信息（脱敏）

**逻辑**

1.校验用户账户密码是否合法

1. 非空
2. 长度判断
3. 账户不包含特殊字符

2.校验密码是否输入正确，和数据库中的密文密码去对比

3.返回用户信息

1. 脱敏（不返回关键数据）

4.记录用户的登录状态（session）,将其存储到服务器上（利用SpringBoot框架封装的服务器tomcat记录）

5.单元测试

### 如何判断是哪个用户登录？

1.连接服务器端后，会得到一个session1状态，返回给前端

2.登录成功后，得到了登录成功的session，给session设置相应的值，返回给前端一个设置 cookie的命令，

3.前端收到后端的命令后，设置cookie 存储到浏览器本地

4.前端再次请求服务器时，携带cookie 去访问

5.服务器判断前端传来的cookie，是否和session一致。



## 用户管理接口

用户表扩展一个userRole属性 表示用户的角色，必须鉴权

1.查询用户

1. 允许根据用户名查询

2.删除用户

1. 根据用户名进行删除



**用户登录状态接口**



## 优化

### 后端优化

1、返回通用对象 

目的: 给返回对象补充一些信息，告诉前端在业务上是否请求成功，如果请求失败 返回相应提示

```json
{
	"code": 0, //业务状态码
    "data": {
        //数据信息 列表或者其他
        
    },
    "message": ""  
}
```

2、封装全局异常处理

1. 定义业务异常类

   1. 扩展运行时异常

      1. 自定义构造函数，更灵活的设置字段

   2. ​	编写全局异常处理器

      作用：

      1.捕捉代码中的所有异常（业务异常和运行时异常），记录日志，内部消化，返回给前端通用的返回对象信息

      2.同时屏蔽掉代码项目框架本身的异常

      3.集中处理，比如记录日志

   实现：AOP（面向切面编程）在调用方法前后进行额外的处理

3、全局请求日志和登录校验



## 项目部署



